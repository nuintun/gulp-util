/**
 * @module @nuintun/gulp-util
 * @author nuintun
 * @license MIT
 * @version 0.1.0
 * @description Utilities for gulp-cmd and gulp-css.
 * @see https://github.com/nuintun/gulp-util
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Vinyl=require("vinyl"),chalk=require("chalk"),path=require("path"),debug=require("debug"),timestamp=require("time-stamp");const EXTRACT_TYPE_RE=/\[object (.+)\]/i,toString=Object.prototype.toString,getPrototypeOf=Object.getPrototypeOf,hasOwnProperty=Object.prototype.hasOwnProperty,fnToString=hasOwnProperty.toString,objectFunctionString=fnToString.call(Object);function typeOf(t){let e=toString.call(t);if("number"===(e=e.replace(EXTRACT_TYPE_RE,"$1").toLowerCase())){if(t!=t)return"nan";if(t===1/0||t===-1/0)return"infinity"}return e}function isFunction(t){return"function"==typeof t}function isPlainObject(t){let e,r;return!(!t||"object"!==typeOf(t))&&(!(e=getPrototypeOf(t))||"function"==typeof(r=hasOwnProperty.call(e,"constructor")&&e.constructor)&&fnToString.call(r)===objectFunctionString)}function isString(t){return"string"===typeOf(t)}function slice(t,e){e>>>=0;const r=t.length;if(e>=r)return[];const n=new Array(r-e);for(;r-- >e;)n[r-e]=t[r];return n}const OUTBOUND_RE=/(?:^[\\\/]?)\.\.(?:[\\\/]|$)/;function parseId(t,e,r){let n=path.relative(r,t.path);return OUTBOUND_RE.test(n)&&(n=path.relative(e,t.path),OUTBOUND_RE.test(n)&&throwError("file %s is out of bound of wwwroot %s.",normalize(t.path),normalize(e)),n=path.join("/",n)),normalize(n)}const WINDOWS_PATH_RE=/\\/g,SCHEME_SLASH_RE=/(:)?\/{2,}/,DOT_RE=/\/\.\//g,MULTI_SLASH_RE=/([^:])\/{2,}/g,DOUBLE_DOT_RE=/([^/]+)\/\.\.(?:\/|$)/g,XSS_RE=/^\/(\.\.\/)+/;function normalize(t){let e=t=(t=(t=(t=t.replace(WINDOWS_PATH_RE,"/")).replace(SCHEME_SLASH_RE,"$1//")).replace(DOT_RE,"/")).replace(MULTI_SLASH_RE,"$1/");for(;;){if(t===(e=e.replace(DOUBLE_DOT_RE,(t,e)=>".."===e?t:"")))break;t=e}return t=t.replace(XSS_RE,"/")}const RELATIVE_RE=/^\.{1,2}[\\/]/;function isRelative(t){return RELATIVE_RE.test(t)}const ABSOLUTE_RE=/^[\\/](?:[^\\/]|$)/;function isAbsolute(t){return ABSOLUTE_RE.test(t)}const NONLOCAL_RE=/^(?:[a-z0-9.+-]+:)?\/\/|^data:\w+?\/\w+?[,;]/i;function isLocal(t){return!NONLOCAL_RE.test(t)}function isOutBound(t,e){return OUTBOUND_RE.test(path.relative(e,t))}const cwd=process.cwd();function path2cwd(t){return normalize(path.relative(cwd,t))||"./"}function parseMap(t,e,r,n){let o;return isFunction(e)&&(o=e(t,r,n)),o&&isString(o)?o:t}function readonly(t,e,r){const n={__proto__:null,writable:!1,enumerable:!0,configurable:!1};arguments.length>=3&&(n.value=r),Object.defineProperty(t,e,n)}function apply(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2]);default:return t.apply(e,r)}}async function pipeline(t,e,r){for(let n in e){const e=n[r](t);if(Vinyl.isVinyl(e))throw new TypeError(`The hook '${r}' in plugin '${n.name}' must be returned a vinyl file.`);t=e}return t}function hash(t){return`${t.size.toString(16)}-${t.mtime.getTime().toString(16)}`}class Cache{constructor(){this.cached=new Map}set(t){const e=hash(t.stat);return this.cached.set(t.path,{version:e,vinyl:t}),this}get(t){const e=t.path;if(this.cached.has(e)){const r=this.cached.get(e);if(r.version===hash(t.stat))return r.vinyl}}clear(){this.cached.clear()}}function debug$1(t){const e=debug(t);return e.color=6,e}function getTimestamp(){return`[${chalk.reset.gray(timestamp("HH:mm:ss"))}]`}function log(){const t=getTimestamp();return process.stdout.write(`${t} `),apply(console.log,console,arguments),this}debug.formatters.r=function(t){return chalk.reset.magenta(path2cwd(t))},debug.formatters.p=function(t){return chalk.reset.magenta(t)},debug.formatters.P=function(t){return chalk.reset.magenta(normalize(t))};const undef=void 0;function extend(){let t=1,e=!1;const r=arguments.length;let n,o,i,s,a,c,l=arguments[0]||{};for("boolean"==typeof l&&(e=l,l=arguments[t++]||{}),"object"==typeof l||isFunction(l)||(l={});t<r;t++)if(null!=(n=arguments[t]))for(o in n)n.hasOwnProperty(o)&&(i=l[o],l!==(s=n[o])&&(e&&s&&(isPlainObject(s)||(a=Array.isArray(s)))?(a?(a=!1,c=i&&Array.isArray(i)?i:[]):c=i&&isPlainObject(i)?i:{},l[o]=extend(e,c,s)):s!==undef&&(l[o]=s)));return l}exports.Cache=Cache,exports.debug=debug$1,exports.logger=log,exports.extend=extend,exports.typeOf=typeOf,exports.isFunction=isFunction,exports.isPlainObject=isPlainObject,exports.isString=isString,exports.slice=slice,exports.parseId=parseId,exports.normalize=normalize,exports.isRelative=isRelative,exports.isAbsolute=isAbsolute,exports.isLocal=isLocal,exports.isOutBound=isOutBound,exports.path2cwd=path2cwd,exports.parseMap=parseMap,exports.readonly=readonly,exports.apply=apply,exports.pipeline=pipeline;